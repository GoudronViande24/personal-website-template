/*
 * slide-nav 1.0.1
 * ES6 Vanilla.js navigation plugin to simple use on one-page websites.
 * https://github.com/qmixi/slide-nav
 *
 * Copyright (C) 2017 - A project by Piotr Kumorek
 * Released under the MIT license.
*/

export default class SlideNav{constructor(options){if(!options)var options={};this.activeClass=options.activeClass||"active",this.toggleButtonSelector=options.toggleButtonSelector||!1,this.toggleBoxSelector=options.toggleBoxSelector||!1,this.speed=options.speed>0?options.speed:70,this.hideAfterSelect=options.hideBoxAfterSelect||!0,this.changeHash=options.changeHash||!1,this.navBoxToggleClass=options.navBoxToggleClass||!1,this.init()}init(){this.scrollDoc=document.scrollingElement||document.documentElement,this.getElements(),this.observe(),this.setActiveAnchor()}getElements(){this.toggleButton=document.querySelector(this.toggleButtonSelector),this.toggleButton&&(this.opened=!1),this.toggleBoxes=document.querySelectorAll(this.toggleBoxSelector),this.navAnchors=document.querySelectorAll('a:not([target="_blank"])')}observe(){window.addEventListener("click",e=>{!this.opened||this.isClosestElement(e.target,this.toggleButton)||this.isBoxNavTarget(e.target)||this.hideNavBox()}),this.toggleButton&&this.toggleButton.addEventListener("click",e=>{setTimeout(()=>{this.opened?this.hideNavBox():this.showNavBox()})});for(let anchor of this.navAnchors)anchor.addEventListener("click",e=>{e.preventDefault();let linkHash=this.getHash(e.currentTarget.href);!this.goToSection(linkHash)&&e.currentTarget.href&&this.goToUrl(e.currentTarget.href)});window.addEventListener("scroll",()=>{this.setActiveAnchor()})}setActiveAnchor(){for(let anchor of this.navAnchors){const linkHash=this.getHash(anchor.href),section=this.getSection(linkHash),offset=this.scrollDoc.scrollTop,scrollHeight=this.scrollDoc.scrollHeight;if(section&&(section.offsetTop<=offset&&section.offsetTop+section.offsetHeight>offset||offset+window.innerHeight==scrollHeight)){for(let link of this.navAnchors)link.href!=anchor.href&&link.classList.remove("active");anchor.classList.add("active")}}}goToSection(linkHash){const section=this.getSection(linkHash);if(section){const offsetTop=section.offsetTop;return this.scrollTo(offsetTop,this.speed),this.hideAfterSelect&&this.hideNavBox(),this.changeHash&&history.pushState({},null,"#"+linkHash),!0}return!1}scrollTo(destOffset,duration){const diffOffset=destOffset-this.scrollDoc.scrollTop,partDist=diffOffset/duration*1;duration<=0||setTimeout(()=>{this.scrollDoc.scrollTop=this.scrollDoc.scrollTop+partDist,this.scrollDoc.scrollTop!=destOffset&&this.scrollTo(destOffset,duration-1)},1)}goToUrl(url){return window.location=url}getSection(linkHash){if(linkHash){const id="#"+linkHash;return document.querySelector(id)}return!1}getHash(href){return href.split("#")[1]}isBoxNavTarget(target){var isTarget=!1;for(let box of this.toggleBoxes)this.isClosestElement(target,box)&&(isTarget=!0);return isTarget}isClosestElement(target,element){for(;element!=target;)if(!(target=target.parentNode))return!1;return!0}hideNavBox(){for(let box of this.toggleBoxes)this.navBoxToggleClass?box.classList.remove(this.navBoxToggleClass):box.style.display="none";this.opened=!1}showNavBox(){for(let box of this.toggleBoxes)this.navBoxToggleClass?box.classList.add(this.navBoxToggleClass):box.style.display="block";this.opened=!0}}